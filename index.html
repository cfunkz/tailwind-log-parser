<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Parser</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white">

<div class="container mx-auto p-6 bg-black shadow-lg rounded-lg max-w-[99%]">
    <h1 class="text-center text-3xl font-bold mb-6">Upload up to 25MB .log, .txt or .csv file</h1>

    <div class="text-center mb-6">
        <input type="file" id="fileInput" class="px-4 py-2 border border-gray-300 rounded-md mr-4" />
        <button id="uploadBtn" class="px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">Upload</button>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
        <label><input type="checkbox" id="email" checked /> Email</label>
        <label><input type="checkbox" id="date" checked /> Date</label>
        <label><input type="checkbox" id="time" checked /> Time</label>
        <label><input type="checkbox" id="ip" checked /> IP</label>
        <label><input type="checkbox" id="mac" checked /> MAC</label>
        <label><input type="checkbox" id="ipv6" checked /> IPv6</label>
        <label><input type="checkbox" id="hex" checked /> Hex</label>
        <label><input type="checkbox" id="statusCode" checked /> Status Code</label>
        <label><input type="checkbox" id="domain" checked /> Domain</label>
        <label><input type="checkbox" id="httpMethods" checked /> HTTP Methods</label>
        <label><input type="checkbox" id="netMethods" checked /> Network Methods</label>
        <label><input type="checkbox" id="logLevel" checked /> Log Level</label>
        <label><input type="checkbox" id="filepath" checked /> File Path</label>
        <label><input type="checkbox" id="md5" checked /> MD5</label>
        <label><input type="checkbox" id="sha1" checked /> SHA1</label>
        <label><input type="checkbox" id="sha256" checked /> SHA256</label>
        <label><input type="checkbox" id="pid" checked /> PID</label>
        <label><input type="checkbox" id="currency" checked /> Currency</label>
        <label><input type="checkbox" id="coordinates" checked /> Coordinates</label>
        <label><input type="checkbox" id="ansiEscape" checked /> ANSI Escape</label>
    </div>

    <p id="logContent" class="text-center text-green-700 mt-6"></p>
    <pre id="formattedContent" class="bg-black text-white p-4 rounded-md mt-4 text-sm whitespace-pre-wrap break-words"></pre>
</div>

<script>
    const uploadBtn = document.getElementById("uploadBtn");
    const fileInput = document.getElementById("fileInput");
    const logContent = document.getElementById("logContent");
    const formattedContent = document.getElementById("formattedContent");

    const selectedPatterns = {
        email: true,
        date: true,
        time: true,
        ip: true,
        mac: true,
        ipv6: true,
        hex: true,
        statusCode: true,
        domain: true,
        httpMethods: true,
        netMethods: true,
        logLevel: true,
        filepath: true,
        md5: true,
        sha1: true,
        sha256: true,
        pid: true,
        currency: true,
        coordinates: true,
        ansiEscape: true
    };

    const regexPatterns = {
        email: /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b/g,
        date: /\b(\d{4}-\d{2}-\d{2}|\d{2}\/\d{2}\/\d{4}|\d{2}\.\d{2}\.\d{4})\b/g,
        time: /\b\d{2}:\d{2}:\d{2}\b/g,
        ip: /\b\d{1,3}(\.\d{1,3}){3}\b/g,
        mac: /\b([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}\b/g,
        ipv6: /\b([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:)\b/g,
        hex: /\b0x[0-9A-Fa-f]+\b/g,
        statusCode: /\b(2\d{2}|3\d{2}|4\d{2}|5\d{2})\b/g,
        domain: /\b(?:[A-Za-z0-9-]{1,63}\.)+[A-Za-z]{2,6}(?=\s|:|$)/g,
        httpMethods: /\b(?:get|post|put|delete|patch|options|head|trace|connect|port|http|https)\b/gi,
        netMethods: /\b(?:tcp|udp|icmpv6|icmp|ping|pppoe|lan|wan|ttl|hoplimit|syn|ack|data|system|firewall|in|out|hop|proto|protocol)\b/gi,
        logLevel: /\b(?:error|warning|critical|info|debug|notice)\b/gi,
        filepath: /(?:\/(?:[\w\s-]+\/)+[\w\s-]+(?:\/|\.[a-zA-Z0-9]+)?)/g,
        md5: /\b[a-f0-9]{32}\b/gi,
        sha1: /\b[a-f0-9]{40}\b/gi,
        sha256: /\b[a-f0-9]{64}\b/gi,
        pid: /\bPID\s\d{1,6}\b/g,
        currency: /(?:£|\$|€)\d+(?:,\d{3})*(?:\.\d{2})?/g,
        coordinates: /\b-?\d{1,3}\.\d{6,},\s?-?\d{1,3}\.\d{6,}\b/g,
        ansiEscape: /\x1B\[[0-9;]*m/g
    };

    const regexColours = {
        email: 'gray',
        time: 'blue',
        ip: 'purple',
        mac: 'black',
        ipv6: 'darkviolet',
        hex: 'red',
        statusCode: 'purple',
        filepath: 'orange',
        date: 'blue',
        md5: 'saddlebrown',
        sha1: 'brown',
        sha256: 'darkgoldenrod',
        pid: 'darkgreen',
        currency: 'gold',
        coordinates: 'darkcyan',
        ansiEscape: 'grey',
        httpMethods: {
            get: 'green',
            post: 'blue',
            put: 'darkred',
            delete: 'darkred',
            patch: 'yellow',
            options: 'lightgreen',
            head: 'purple',
            trace: 'magenta',
            connect: 'pink',
            default: 'grey'
        },
        logLevel: {
            error: 'red',
            warning: 'orange',
            critical: 'darkred',
            info: 'grey',
            debug: 'lightgrey',
            notice: 'lightgreen'
        },
        netMethods: {
            tcp: 'cyan',
            udp: 'lightblue',
            icmpv6: 'yellowgreen',
            icmp: 'lime',
            ping: 'lightcoral',
            pppoe: 'orangered',
            lan: 'mediumvioletred',
            wan: 'darkorange',
            ttl: 'saddlebrown',
            proto: 'gold',
            hoplimit: 'darkslategray',
            syn: 'tomato',
            ack: 'lightseagreen',
            default: 'grey'
        },
        domain: 'lightblue'
    };

    function highlightContent(content) {
        Object.keys(selectedPatterns).forEach(pattern => {
            if (selectedPatterns[pattern]) {
                const regex = regexPatterns[pattern];
                const colour = typeof regexColours[pattern] === 'object'
                    ? regexColours[pattern]
                    : regexColours[pattern];
                content = content.replace(regex, match => {
                    let matchColour = colour;
                    if (typeof regexColours[pattern] === 'object') {
                        const matchedMethod = match.toLowerCase();
                        matchColour = regexColours[pattern][matchedMethod] || regexColours[pattern].default;
                    }
                    return `<span class="highlight" style="color: ${matchColour};">${match}</span>`;
                });
            }
        });

        return content;
    }

    function checkByteContent(content) {
        const textBytes = Array.from(new TextEncoder().encode(content));
        const nonTextCount = textBytes.filter(byte => (byte < 32 || byte > 126) && ![9, 10, 13].includes(byte)).length;
        return (nonTextCount / textBytes.length) < 0.01;
    }

    function setLogMessage(message, isError = false) {
        logContent.textContent = message;
        if (isError) {
            logContent.classList.remove('text-green-700');
            logContent.classList.add('text-red-700');
        } else {
            logContent.classList.remove('text-red-700');
            logContent.classList.add('text-green-700');
        }
    }

    const MAX_FILE_SIZE = 25 * 1024 * 1024;

    function fileUpload() {
        const file = fileInput.files[0];
    
        if (!file) {
            setLogMessage('Select a log file.', true);
            return;
        }
    
        if (file.size > MAX_FILE_SIZE) {
            setLogMessage('The selected file exceeds the maximum size limit of 25MB.', true);
            return;
        }
    
        const reader = new FileReader();
        reader.onload = function(e) {
            const fileContent = e.target.result;
            if (checkByteContent(fileContent)) {
                const highlightedContent = highlightContent(fileContent);
                formattedContent.innerHTML = highlightedContent;
                setLogMessage('File uploaded and processed successfully!', false);
            } else {
                setLogMessage('The file contains non-text characters and is not valid.', true);
            }
        };
    
        reader.onerror = function() {
            setLogMessage('There was an error reading the file.', true);
        };
    
        reader.readAsText(file);
    }
    
    Object.keys(selectedPatterns).forEach(pattern => {
        const checkbox = document.getElementById(pattern);
        checkbox.addEventListener('change', function() {
            selectedPatterns[pattern] = checkbox.checked;
        });
    });

    uploadBtn.addEventListener("click", fileUpload);
</script>

</body>
</html>
